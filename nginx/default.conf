server {
    listen 80;  # Escucha en el puerto 80 (HTTP)
    server_name localhost;  # Nombre del servidor

    # Ruta raíz dentro del contenedor
    # Todas las solicitudes "/" apuntarán a esta carpeta
    root /var/www/html/frontend;

    # Archivos por defecto que Nginx servirá
    # Primero index.php, luego index.html si no existe el primero
    index index.php index.html;

    # =========================================
    # Bloque Frontend
    # Maneja todas las solicitudes a la raíz del sitio
    # =========================================
    location / {
        # try_files revisa si existe el archivo o directorio solicitado
        # Si no existe, redirige la petición a index.php con los parámetros de la query
        # Esto permite manejar rutas virtuales o frameworks PHP
        try_files $uri $uri/ /index.php?$query_string;
    }

    # =========================================
    # PHP en Frontend
    # Ejecuta archivos .php en la raíz del frontend
    # =========================================
    location ~ \.php$ {
        include fastcgi_params;  # Incluye parámetros básicos de FastCGI
        # SCRIPT_FILENAME apunta al archivo real dentro del contenedor
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_pass php:9000;  # Pasa la petición al contenedor PHP-FPM
    }

    # =========================================
    # Bloque Backend
    # Maneja todas las solicitudes a /backend/
    # =========================================
    location /backend/ {
        # Alias apunta a la carpeta backend dentro del contenedor
        alias /var/www/html/backend/;

        # Archivo por defecto
        index index.php;

        # PHP en Backend
        location ~ \.php$ {
            include fastcgi_params;  # Incluye parámetros FastCGI
            # SCRIPT_FILENAME apunta al archivo PHP solicitado
            fastcgi_param SCRIPT_FILENAME $request_filename;
            fastcgi_pass php:9000;  # Pasa la petición al contenedor PHP-FPM
        }
    }
}
